# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

ZoneShift is a client-side DNS migration verification tool for Umetech MSP. It parses GoDaddy BIND zone file exports, reformats them for Constellix import (stripping SOA/root NS records), and compares DNS records between old and new nameservers via DNS-over-HTTPS before NS cutover.

Live at https://zoneshift.umetech.net. No backend — all logic runs in the browser.

## Commands

```bash
npm install          # Install dependencies
npm run dev          # Start Vite dev server
npm run build        # TypeScript check + Vite build to dist/
npm run lint         # ESLint
```

**Restricted shell note:** The UMT dev environment has a locked-down PATH (`/home/jgoode/bin` only). `npm create`, `npx`, and postinstall scripts may fail because `sh` is not in PATH. Workarounds:
- `npm install --ignore-scripts` then verify modules manually
- Run Vite/tsc directly via `node node_modules/typescript/bin/tsc` or `node build.mjs`

## Architecture

**4-step wizard** orchestrated by `App.tsx`:

```
ZoneFileImport → parseZoneFile() → ParsedZone
                                      ↓
FormattedOutput ← formatForConstellix(parsed)
RecordTable     ← parsed.records
                                      ↓
NSLookup        → lookupNS(domain) → currentNS[]
                                      ↓
ComparisonTable → queryAllRecords() on both NS → compareRecords() → ComparisonResult
```

State lives in `App.tsx`: `step` (1-4), `parsed` (ParsedZone | null), `currentNS` (string[]). Components receive data via props and report back through callbacks (`onImport`, `onNSFound`).

### Utils (the core logic)

- **`zoneParser.ts`** — `parseZoneFile()` parses BIND format, handles multi-line SOA (paren depth tracking), strips SOA + root NS + header comments. `formatForConstellix()` outputs clean BIND grouped by record type.
- **`dnsLookup.ts`** — `dohLookup()` queries Google DoH (`https://dns.google/resolve`). `queryAllRecords()` batches queries (5 concurrent) across subdomains x record types, deduplicates results.
- **`recordComparison.ts`** — `compareRecords()` groups by name+type, normalizes values (strip trailing dots, quotes, lowercase), returns rows with match/mismatch/missing_new/new status.

### Key types

- `DnsRecord` — parsed zone record: name, ttl, class, type, value
- `ParsedZone` — origin string + DnsRecord[]
- `ResolvedRecord` — live DNS result: name, type, ttl, value
- `ComparisonRow` — old/new values + MatchStatus
- `ComparisonResult` — rows[] + match/mismatch/missing counts

## DNS Comparison Subdomains

ComparisonTable queries a default set plus any found in the zone file:
`@`, `www`, `mail`, `ftp`, `cpanel`, `webmail`, `webdisk`, `whm`, `autodiscover`, `enterpriseenrollment`, `enterpriseregistration`, `selector1._domainkey`, `selector2._domainkey`, `_dmarc`

Query types: A, AAAA, MX, TXT, CNAME, NS

## Constellix Import Rules

Output must be BIND9 format with: `$ORIGIN` directive kept, SOA removed, root NS records (`@ IN NS`) removed, records grouped by type with `;` section comments.

## UI Theme

Dark palette (`#0d1117` bg), green `#238636` success, red `#da3633` errors, blue `#1f6feb` info. System monospace font stack. All styles in `src/index.css`. Mobile breakpoint at 640px.

## Deployment

- **Azure Static Web App** in `MissionControl` resource group (Free tier)
- **GitHub Actions** workflow: `.github/workflows/azure-static-web-apps-calm-flower-0a61c0010.yml` (auto-generated by Azure)
- **Repo**: `UMTJG00d3/zoneshift` on GitHub
- Pushes to `main` auto-deploy. PRs get staging environments.

## Related Projects

- **UMT-HUD** (`/root/projects/UMT-HUD`) — Mission Control dashboard at https://cloudops.umetech.net — "Tools" menu links to this tool
